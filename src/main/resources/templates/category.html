<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${activeCategory != null ? activeCategory : 'Category'}">
        Category
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&display=swap"
          rel="stylesheet">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
          rel="stylesheet">

    <!-- Custom Styles -->
    <link rel="stylesheet" th:href="@{/css/style.css}">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
          rel="stylesheet">
</head>

<body>

<!-- ================= HEADER ================= -->
<th:block th:with="
        lang=${lang != null ? lang : 'en'},
        categories=${categories},
        activeCategory=${activeCategory}
">
    <div th:replace="~{fragments/header :: header}"></div>
</th:block>


<div class="page-content">
    <!-- ================= MAIN ================= -->
    <div class="container my-5">

        <!-- CATEGORY TITLE -->
        <h2 class="hero-title mb-4 text-uppercase"
            th:text="${activeCategory}">
            CATEGORY
        </h2>

        <!-- ================= SORT TABS ================= -->
        <div class="glass-filter-group mb-4"
             th:attr="data-active=${sort}">

            <a th:href="@{/{lang}/category/{category}(
            lang=${lang},
            category=${activeCategory},
            sort='latest'
        )}"
               class="glass-filter-btn"
               th:classappend="${sort == 'latest' ? ' active' : ''}">
                Latest
            </a>

            <a th:href="@{/{lang}/category/{category}(
            lang=${lang},
            category=${activeCategory},
            sort='popular'
        )}"
               class="glass-filter-btn"
               th:classappend="${sort == 'popular' ? ' active' : ''}">
                Popular
            </a>

            <a th:href="@{/{lang}/category/{category}(
            lang=${lang},
            category=${activeCategory},
            sort='oldest'
        )}"
               class="glass-filter-btn"
               th:classappend="${sort == 'oldest' ? ' active' : ''}">
                Oldest
            </a>

        </div>

        <!-- EMPTY STATE -->
        <div th:if="${posts == null or #lists.isEmpty(posts)}"
             class="alert alert-secondary text-center">

            <span th:text="${lang == 'kn'
                ? 'à²‡à²²à³à²²à²¿ à²‡à²¨à³à²¨à³‚ à²à²¨à³‚ à²‡à²²à³à²² â€” à²†à²¦à²°à³† à²…à²¦à³à²­à³à²¤à²µà²¾à²¦à²¦à³à²¦à³ à²¶à³€à²˜à³à²°à²¦à²²à³à²²à³‡ à²¬à²°à³à²¤à³à²¤à²¿à²¦à³† âœ¨
                    à²ˆ à²µà²¿à²­à²¾à²—à²•à³à²•à²¾à²—à²¿ à²…à²°à³à²¥à²ªà³‚à²°à³à²£ à²²à³‡à²–à²¨à²—à²³à²¨à³à²¨à³ à²¨à²¾à²µà³ à²¸à²¿à²¦à³à²§à²ªà²¡à²¿à²¸à³à²¤à³à²¤à²¿à²¦à³à²¦à³‡à²µà³†.'
                : 'Nothing here yet â€” but something great is coming âœ¨
                   Weâ€™re working on thoughtful stories for this category.'}">
            </span>

        </div>

        <!-- POSTS GRID -->
        <div class="row g-4"
             th:if="${posts != null and !#lists.isEmpty(posts)}">

            <div class="col-md-4"
                 th:each="post : ${posts}">

                <!-- ðŸ”¥ CORRECT BLOG LINK -->
                <a th:href="@{/{lang}/blog/{slug}(
            lang=${lang != null ? lang : 'en'},
            slug=${post.slug})}"
                   class="card post-card h-100 text-decoration-none text-dark shadow-sm">

                    <!-- IMAGE -->
                    <img th:src="${post.imageUrl != null ? post.imageUrl : '/images/placeholder.png'}"
                         class="card-img-top"
                         style="height:180px; object-fit:cover;"
                         alt="Post image">

                    <div class="card-body d-flex flex-column">

                        <!-- AI PROMPT BADGE -->
                        <span th:if="${post.category.name() == 'AI'
                and post.aiPostMode != null
                and post.aiPostMode.name() == 'PROMPT'}"
                              class="badge ai-prompt-badge">
            ðŸ¤– AI PROMPT
        </span>

                        <!-- CATEGORY -->
                        <small class="text-muted text-uppercase mb-1"
                               th:text="${post.category}">
                        </small>

                        <!-- TITLE -->
                        <h6 class="fw-bold mb-2"
                            th:text="${post.title}">
                        </h6>

                        <!-- AUTHOR -->
                        <div class="small text-muted mb-2">
                            By <span th:text="${post.authorName != null ? post.authorName : 'Admin'}"></span>
                        </div>

                        <!-- STATS -->
                        <div class="d-flex gap-3 mt-auto small text-muted align-items-center">

                            <!-- Applause -->
                            <!-- Likes / Applause -->
                            <span class="d-flex align-items-center gap-1">
                                <i class="bi bi-hand-thumbs-up"></i>
                                <span th:text="${post.applauseCount}">0</span>
                            </span>

                            <!-- Comments -->
                            <span class="d-flex align-items-center gap-1">
                                <i class="bi bi-chat-dots"></i>
                                <span th:text="${post.commentCount}">0</span>
                            </span>

                            <!-- Views -->
                            <span class="d-flex align-items-center gap-1">
                                <i class="bi bi-eye"></i>
                                <span th:text="${post.views}">0</span>
                            </span>

                        </div>

                    </div>
                </a>

            </div>
        </div>

    </div>
</div>


<!-- ================= FOOTER ================= -->
<div th:replace="~{fragments/footer :: footer}"></div>

</body>
</html>