<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Dashboard â€¢ TQtadka</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet">

    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>

<div th:replace="~{fragments/header :: header}"></div>

<div class="page-content container my-5">

    <!-- ================= TITLE ================= -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold">ðŸ“Š Dashboard</h2>

        <span class="text-muted" th:if="${isAdmin}">Admin View</span>
        <span class="text-muted" th:unless="${isAdmin}">Author View</span>
    </div>

    <!-- ================= STATS ================= -->
    <div class="row g-4 mb-5">

        <div class="col-md-3">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="text-muted small">Total Posts</div>
                    <div class="fs-4 fw-bold" th:text="${stats.totalPosts} ?: 0">0</div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="text-muted small">Total Views</div>
                    <div class="fs-4 fw-bold" th:text="${stats.totalViews} ?: 0">0</div>
                </div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="text-muted small">This Month</div>
                    <div class="fs-5 fw-bold" th:text="${stats.viewsThisMonth} ?: 0">0</div>
                </div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="text-muted small">This Week</div>
                    <div class="fs-5 fw-bold" th:text="${stats.viewsThisWeek} ?: 0">0</div>
                </div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="text-muted small">Today</div>
                    <div class="fs-5 fw-bold" th:text="${stats.viewsToday} ?: 0">0</div>
                </div>
            </div>
        </div>

    </div>

    <!-- ================= FILTERS ================= -->
    <form method="get" class="d-flex gap-3 mb-4">

        <input type="hidden" name="sort" th:value="${sort}">
        <input type="hidden" name="dir" th:value="${dir}">

        <!-- CATEGORY -->
        <select name="category" class="form-select w-auto"
                onchange="this.form.submit()">
            <option value="">All Categories</option>
            <option th:each="c : ${categories}"
                    th:value="${c.name()}"
                    th:selected="${param.category != null and param.category[0] == c.name()}"
                    th:text="${c}">
            </option>
        </select>

        <!-- AUTHOR (ADMIN ONLY) -->
        <select name="authorId"
                class="form-select w-auto"
                th:if="${isAdmin}"
                onchange="this.form.submit()">
            <option value="">All Authors</option>
            <option th:each="a : ${authors}"
                    th:value="${a.id}"
                    th:selected="${param.authorId != null and param.authorId[0] == a.id.toString()}"
                    th:text="${a.name}">
            </option>
        </select>

    </form>

    <!-- ================= TABLE ================= -->
    <div class="card shadow-sm">
        <div class="card-body">

            <h5 class="fw-bold mb-3">Posts</h5>

            <div th:if="${posts == null or #lists.isEmpty(posts)}"
                 class="alert alert-secondary text-center">
                No posts found.
            </div>

            <table class="table align-middle"
                   th:if="${posts != null and !#lists.isEmpty(posts)}">

                <thead>
                <tr>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Category</th>
                    <th>This Month</th>
                    <th>Last Month</th>
                    <th>Total Views</th>
                    <th>Published</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="p : ${posts}">

                    <td style="max-width:260px;">
                        <a th:href="@{/{lang}/blog/{slug}(lang=${lang},slug=${p.slug})}"
                           class="text-decoration-none fw-semibold text-dark"
                           th:text="${#strings.abbreviate(p.title, 40)}">
                        </a>
                    </td>

                    <td th:text="${isAdmin ? p.authorName : 'You'}"></td>
                    <td th:text="${p.category}"></td>
                    <td th:text="${p.viewsThisMonth} ?: 0"></td>
                    <td th:text="${p.viewsLastMonth} ?: 0"></td>
                    <td th:text="${p.totalViews} ?: 0"></td>

                    <td th:text="${p.publishedAt != null
                        ? #temporals.format(p.publishedAt, 'dd MMM yyyy')
                        : '-'}">
                    </td>

                </tr>
                </tbody>
            </table>

        </div>
    </div>

</div>

<div th:replace="~{fragments/footer :: footer}"></div>

</body>
</html>