<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Admin · Posts</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet">

    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<!-- ================= ADMIN SAFE HEADER ================= -->
<th:block th:with="lang='en', categories=${null}, activeCategory=${null}">
    <div th:replace="~{fragments/header :: header}"></div>
</th:block>

<div class="container my-5">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold mb-0">Manage Posts</h2>

        <a href="/admin/posts/create"
           class="btn btn-dark">
            + Create Post
        </a>
    </div>

    <!-- ================= POSTS LIST ================= -->
    <div th:if="${#lists.isEmpty(posts)}"
         class="alert alert-secondary">
        No posts created yet.
    </div>

    <table th:unless="${#lists.isEmpty(posts)}"
           class="table table-bordered align-middle">

        <thead class="table-light">
        <tr>
            <th>Title</th>
            <th>Lang</th>
            <th>Category</th>
            <th>Status</th>
            <th>Views</th>
            <th style="width:220px;">Actions</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="post : ${posts}">
            <td th:text="${post.title}"></td>

            <td>
                <span class="badge bg-info text-dark"
                      th:text="${post.language}">
                </span>
            </td>

            <td th:text="${post.category}"></td>

            <td>
                <span th:if="${post.published}"
                      class="badge bg-success">Published</span>
                <span th:unless="${post.published}"
                      class="badge bg-secondary">Draft</span>
            </td>

            <td th:text="${post.views != null ? post.views : 0}"></td>

            <td>
                <!-- EDIT -->
                <a th:href="@{/admin/posts/edit/{slug}/{language}(
                        slug=${post.slug},
                        language=${post.language})}"
                   class="btn btn-sm btn-outline-primary me-1">
                    Edit
                </a>

                <!-- DELETE (FIXED) -->
                <form method="post"
                      th:action="@{/admin/posts/delete}"
                      class="d-inline">

                    <!-- ✅ CSRF -->
                    <input type="hidden"
                           th:name="${_csrf.parameterName}"
                           th:value="${_csrf.token}"/>

                    <input type="hidden"
                           name="slug"
                           th:value="${post.slug}">
                    <input type="hidden"
                           name="language"
                           th:value="${post.language}">

                    <button class="btn btn-sm btn-outline-danger"
                            onclick="return confirm('Delete this post?')">
                        Delete
                    </button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>

</div>

<div th:replace="~{fragments/footer :: footer}"></div>

</body>
</html>