<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <title>Admin Â· Users</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet">

    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body class="bg-light">

<!-- ================= HEADER ================= -->
<th:block th:with="lang='en', categories=${null}, activeCategory=${null}">
    <header th:replace="~{fragments/header :: header}"></header>
</th:block>
<br>
<br>
<br>
<br>

<div class="container-fluid">
    <div class="row">

        <!-- ================= SIDEBAR ================= -->
        <aside class="col-md-2 p-0">
            <div th:replace="~{fragments/admin-sidebar :: adminSidebar}"></div>
        </aside>

        <!-- ================= MAIN CONTENT ================= -->
        <main class="col-md-10 p-4">

            <br>
            <br>
            <br>
            <br>

            <!-- PAGE HEADER -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold mb-0">Users</h3>

                <a th:href="@{/admin/users/create}"
                   class="btn btn-dark btn-sm">
                    + Add User
                </a>
            </div>

            <!-- EMPTY STATE -->
            <div th:if="${users == null or #lists.isEmpty(users)}"
                 class="alert alert-secondary">
                No users found.
            </div>

            <!-- USERS TABLE -->
            <div th:if="${users != null and !#lists.isEmpty(users)}"
                 class="card shadow-sm border-0">

                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">

                        <thead class="table-light">
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th style="width:180px;">Actions</th>
                        </tr>
                        </thead>

                        <tbody>
                        <tr th:each="user : ${users}">

                            <!-- NAME -->
                            <td class="fw-semibold" th:text="${user.name}"></td>

                            <!-- EMAIL -->
                            <td th:text="${user.email}"></td>

                            <!-- ROLE -->
                            <td>
                                <span class="badge"
                                      th:text="${user.role}"
                                      th:classappend="
                                          ${user.role.name() == 'ADMIN'} ? ' bg-danger' :
                                          (${user.role.name() == 'AUTHOR'} ? ' bg-primary' : ' bg-secondary')">
                                </span>
                            </td>

                            <!-- STATUS -->
                            <td>
                                <span class="badge"
                                      th:text="${user.enabled ? 'Active' : 'Disabled'}"
                                      th:classappend="${user.enabled} ? ' bg-success' : ' bg-secondary'">
                                </span>
                            </td>

                            <!-- ACTIONS -->
                            <td>
                                <a th:href="@{/admin/users/edit/{id}(id=${user.id})}"
                                   class="btn btn-sm btn-outline-primary me-1">
                                    Edit
                                </a>

                                <form th:action="@{/admin/users/delete}"
                                      method="post"
                                      class="d-inline">

                                    <input type="hidden"
                                           th:name="${_csrf.parameterName}"
                                           th:value="${_csrf.token}" />

                                    <input type="hidden"
                                           name="userId"
                                           th:value="${user.id}" />

                                    <button type="submit"
                                            class="btn btn-sm btn-outline-danger"
                                            onclick="return confirm('Delete this user?')">
                                        Delete
                                    </button>
                                </form>
                            </td>

                        </tr>
                        </tbody>

                    </table>
                </div>
            </div>

        </main>
    </div>
</div>

<!-- ================= FOOTER ================= -->
<footer th:replace="~{fragments/footer :: footer}"></footer>

</body>
</html>